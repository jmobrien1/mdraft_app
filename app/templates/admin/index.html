{% extends "base.html" %}
{% block title %}Admin — mdraft{% endblock %}
{% block content %}
<div class="card">
  <h2>Conversions</h2>
  <div class="row" style="margin:8px 0">
    <form class="row" method="get">
      <input class="input" type="text" name="q" value="{{ q }}" placeholder="Filename contains…"/>
      <select class="input" name="status">
        <option value="" {% if not status %}selected{% endif %}>Any status</option>
        {% for s in ["QUEUED","PROCESSING","COMPLETED","FAILED"] %}
        <option value="{{ s }}" {% if status==s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>
      <select class="input" name="days">
        {% for d in [1,3,7,14,30] %}
        <option value="{{ d }}" {% if days==d %}selected{% endif %}>last {{ d }}d</option>
        {% endfor %}
      </select>
      <button class="btn secondary" type="submit">Filter</button>
      <a class="btn" href="/admin/export.csv?days={{ days }}">Export CSV</a>
      <a class="btn secondary" href="/admin/keys">API keys</a>
    </form>
  </div>
  <div class="section">
    <span class="badge">total: {{ metrics.total }}</span>
    <span class="badge">in window: {{ metrics.since }}</span>
    <span class="badge">24h ok: {{ metrics.completed_24h }}</span>
    <span class="badge">24h failed: {{ metrics.failed_24h }}</span>
  </div>
  <div class="section">
    {% for r in rows %}
    <div class="item">
      <div>
        <span class="mono">{{ r.filename }}</span>
        <span class="badge">{{ r.status }}</span>
        <span class="hint">{{ r.created_at }}</span>
      </div>
      <div class="row">
        <a class="link" href="/api/conversions/{{ r.id }}" target="_blank">JSON</a>
        <a class="link" style="margin-left:12px" href="/api/conversions/{{ r.id }}/markdown" target="_blank">Markdown</a>
        <a class="link" style="margin-left:12px" href="/v/{{ r.id }}" target="_blank">View</a>
      </div>
    </div>
    {% else %}
    <p class="hint">No rows in this window.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
